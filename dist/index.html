<html><head><base href=./><title>Latest News and Notes About KlipTok from the Official KlipTok Blog</title><link rel=stylesheet type=text/css href=site.css><link rel=stylesheet type=text/css href=prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-371VNCMVCF"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[];gtag("js",new Date);gtag("config","G-371VNCMVCF")</script><link rel=alternate type=application/rss+xml title="Latest News and Notes About KlipTok from the Official KlipTok Blog" href=rss.xml></head><body><header><div class=container><a href=./><img src=kliptok.png alt="KlipTok Logo"></a><div><h1><a href=./>KlipTok News and Notes</a></h1><h3>All the latest updates about the KlipTok application</h3></div></div></header><main><div id=sidebar><h2>Links</h2><ul><li><a href=https://kliptok.com>KlipTok</a><li><a href=https://feedback.kliptok.com>KlipTok Feedback</a><li><a href=https://github.com/csharpfritz/KlipTok.Blog>Blog source on GitHub</a><li><a href=https://github.com/csharpfritz/KlipTok.Translations>Translation Repository</a><li><a href=archive.html>All Posts</a></ul><h2>KlipTok uses:</h2><ul><li><a href=https://www.telerik.com/blazor-ui>Telerik UI for Blazor</a><li><a href=https://assemblyai.com>Assembly AI transcription services</a><li><a href=https://ravendb.net>RavenDb database</a><li><a href=https://github.com/csharpfritz/Fritz.StaticWeb>Fritz Static Web Generator</a></ul><a href="https://twitter.com/thekliptok?ref_src=twsrc%5Etfw" class=twitter-follow-button data-show-count=false>Follow @thekliptok</a><script async src=https://platform.twitter.com/widgets.js charset=utf-8></script></div><div id=main><div id=content><h2 class=postTitle><a href=posts/Artificial-Intelligence-and-Mature-Content.html>Artificial Intelligence and Mature Content</a></h2><h4>Written By: Jeffrey T. Fritz</h4><h5>Published: 1/12/2023 09:45:00</h5><p>In the time since KlipTok launched in November 2020, our intent with the content presented is that it would closely mirror the content of Twitch, its parent platform. It's been great to see that the popular games and content from Twitch appear in a similar pattern of growth and waning on KlipTok. To that end, we've seen some content appear that various communities around the world would consider racy.<p>We want to focus on improving the experience for the casual visitors to KlipTok. We define 'casual visitors' as folks who browse to the website without logging in. The casual visitor browses the site and does not want KlipTok to interact with their Twitch account or save preferences for interacting with the site.<p>One of the features requested for some time on the <a href=https://feedback.kliptok.com/posts/47/mature-flag>KlipTok feedback site has been a 'mature flag'</a> that identifies content that could be considered risqu√© or racy that some folks would like to avoid. In this post, we're going to introduce a new 'racy' safety warning on KlipTok and discuss the feedback that went into the feature as well as introduce the next round of features to support this type of community standards enforcement.<h2 id=nothing-is-removed-from-kliptok>Nothing is removed from KlipTok</h2><p>Let's get this clear from the start: KlipTok still delivers all the content that you would find on Twitch. This new feature is intended to make the initial visit from folks who are not logged-in to KlipTok a friendlier and more welcoming experience.<p>All visitors to KlipTok who are not logged-in will by default receive a more family-friendly version of the 'Discover' page that mirrors the standards of the Twitch front page. As the Twitch front page does, certain categories, will not be included in the list of clips for casual visitors. The initial restriction will be the "Pools, Hot Tubs, and Beaches" category. Once a user logs in to KlipTok, clips from this category may appear in the 'Discover' page. This category filtering is only applied to the 'Discover' page for casual visitors. If you are following channels with content in this category, those clips will continue to appear in your 'Following' tab and the individual channel's pages.<h3 id=additional-detection>Additional Detection</h3><p>We all know that folks like to broadcast on different categories with content that crosses the boundaries. To help detect content that might be a little racy for some folks, we have introduced a thumbnail detection feature using <a href=https://learn.microsoft.com/azure/cognitive-services/computer-vision/concept-detecting-adult-content>Microsoft Azure's Computer Vision and Adult Content Detection feature</a>. Clips that are considered for the 'Discover' page on KlipTok will have their thumbnails analyzed by this feature and the <strong>racy</strong> score attached.<p>The Computer Vision feature <a href=https://learn.microsoft.com/azure/cognitive-services/computer-vision/concept-detecting-adult-content#content-flag-definitions>defines racy images</a> as "... sexually suggestive in nature and often contain less sexually explicit content than adult images (adult images are those containing nudity and sexual acts)"<p>For casual visitors to the KlipTok 'Discover' page, they will now receive a content warning and a blurred thumbnail for those clips identified with 90% or higher confidence to contain racy material. Additionally, they will be presented with a lock icon that requires a click to reveal the original thumbnail.</p><img alt="Sample thumbnail detected as racy" src=img/racy-sampleRacyClip.png style="margin:2em auto;display:block;max-height:300px"> <p>This blurring and content warning is only presented on the 'discover' page for users who are not logged in. On the 'following' page and on individual channel pages, this content is presented as is with no blurring or content warnings added.<h2 id=future-considerations>Future Considerations</h2><p>We believe that adding this type of initial 'safe-search' capability to the 'Discover' page means that KlipTok is a little friendlier for new visitors to the site. We acknowledge that not everyone wants to see all the different types of content on KlipTok, and that's ok.<p>In the future, we want to make it easier for users to mute categories and adjust the racy indicator threshold to their preference for clips presented on the 'Discover' page. You may want to hide content from categories like ASMR or Casinos, or perhaps you would hide categories to help elevate the presence of the categories you do like. You may want to allow a little more racy content to appear on the front-page, or you may not want any racy content to appear.<p>You will eventually find these controls in the <a href=https://kliptok.com/profile>user-profile page of KlipTok</a> with your other preferences like 'muted streamers'.<p>These are your preferences, and we want to be transparent about giving you the KlipTok viewer the control that you want over the content we share with you.<h2 class=postTitle><a href=posts/8-CategoriesAndTeams.html>16M Clips, 2M channels, Categories and Teams arrive on KlipTok</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 8/24/2022 11:30:58</h5><p>We hit two large data milestones this month, 16 million clips indexed and more than 2 million channels are now known by KlipTok. It's a huge step in the growth of the application, and we want to thank all of our supporters for helping spread the word about KlipTok.<p>After a few weeks of work, we're delivering two heavily requests sets of pages and content to KlipTok: Categories and Teams.<h2 id=category-pages>Category Pages</h2><p>It's been requested for some time that we should have pages dedicated to the various categories on Twitch. This helps make discovering new content in those categories MUCH easier as you now have one place to browse and see the latest happenings on Twitch.<p><a href=https://kliptok.com/category/fortnite><img src=img/0801-CategoryPage.png alt="Category Page on KlipTok for Fortnite"></a><p>There are several ways to reach the category pages:<ul><li>You can click the category name that is linked next to a clip that is presented</ul><p><img src=img/0802-CategoryLink.png alt="Category Link on a clip from Ninja"><ul><li>You can search for the category in the top bar and choose the item from the drop down list</ul><p><img src=img/0803-CategoryAutocomplete.png alt="Category presented as autocomplete results"><ul><li>You can search KlipTok and find the category in the search page</ul><p><img src=img/0804-CategorySearchResults.png alt="Categories in Search Results"><h2 id=teams-pages>Teams Pages</h2><p>We are also proud to announce the availability of Stream Team pages on KlipTok! Now you can find your favorite teams and check out their collaborations in one place.<p><a href=https://kliptok.com/team/PH16><img src=img/0805-TeamPage.png alt="PH16 Stream Team page"></a><p>Not only can you flip through their recent clips, you can also activate one of two new smart playlists for teams:<ol><li>Most Viewed Clips - a playlist that shows the top 100 clips from the duration currently selected on screen<li>Team Highlights - a playlist that shows the top 100 clips from the team over the last 2 months, with a limit of 3 clips per streamer. This allows more of the teammates content to appear on screen</ol><p>We've carried over the description for a team from the Team's page on Twitch and provided a list of the channels that participate in a team as well.<p>You can find teams for a streamer just below their description on their streamer page:<p><img src=img/0806-TeamsOnStreamerPage.png alt="Teams on csharpfritz's page"><p>Teams can be searched for and will be presented using the same autocomplete and tab locations on the search results page as categories:<p><img src=img/0807-TeamsSearchResults.png alt="Teams on search results page"><p>Finally, you can also filter your clip search results by the members of a team. Consider this scenario:<ul><li>Show me all clips from May 2022<li>For a charity that is named in the title of all clips<li>Within the Live Coders stream team</ul><p>That's pretty powerful to help limit and report back about that charity and present some highlights from stream for them.<h2 id=summary>Summary</h2><p>This is just another step in the evolution of clip discovery and content on KlipTok. We've got a lot more features planned, including our first monetized features. If you have a suggestion or want to report a bug, head over to the <a href=https://feedback.kliptok.com>feedback site</a> and let use know about it. There's some great suggestions there that you will see built and added to the application.<p>Thank you for participating with KlipTok, and we're looking forward to more great klips!<h2 class=postTitle><a href=posts/7-PinChannels.html>Pin Channels and Performance Updates</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 6/19/2022 09:11:32</h5><p>The "secret sauce" of KlipTok has been that it is a service for streamers, written by a streamer, live on stream. This week, we added a new wrinkle to that mix. We added a feauture requested by viewers, designed by viewers.<h2 id=pin-channels-to-the-sidebar>Pin Channels to the Sidebar</h2><p>On Tuesday the 14th, we received <a href=https://feedback.kliptok.com/posts/109/add-feature-pinned-streamers>a feedback entry for the most requested feature</a> to date for KlipTok: Pin Channels to the sidebar.<p><a href=https://feedback.kliptok.com/posts/109/add-feature-pinned-streamers><img src=img/7_1-Feedback.png alt="Feedback entry for Pin Channels"></a><p>It's an idea that makes sense: allow viewers to pin their favorite 3 channels to the sidebar so that they can quickly jump to those channels. The last part of the request, add these channels to the front page of KlipTok, is a little more complicated and not delivered yet.<p>You can now find the <strong>Pin Channel</strong> feature in the <em>kabob menu</em> on the sidebar and with the pin icon in the header of every channel on KlipTok. You can pin a channel and unpin channels with these two buttons.<p><img src=img/7_2-pinned.png alt="Pinned channels on the sidebar with the context menu to unpin"><p><img src=img/7_3-pin-header.png alt="Pin icon in the header of the streamer page"><p>We're evaluating and preparing to add the last requirement of this feature, the 'missed clips on homepage'<h2 id=performance-updates>Performance Updates</h2><p>Additionally, we tuned the interactions the sidebar and streamer pages were having with the database services. For the sidebar, we moved queries for the sections to a parallel request model. On streamer pages, we tuned the interaction the clip list component was using so that it no longer blocks rendering and makes 1 less request to the database service for content.<p>Another update that didn't make a significant change in performance for this feature, but I want to highlight was the conversion of the pin action from an update to a patch. Before I explain the difference, let's take a look at how the new <strong>Pinned Channels</strong> feature is stored in the database.<h2 id=pinned-channels-data-schema>Pinned Channels data schema</h2><p>Pinned channels are a feature that only logged in users can use. As such, those logged in users also have a collections of channels the follow on Twitch that are maintained in the KlipTok database. By Twitch's definition, a <a href=https://blog.twitch.tv/en/2013/03/26/on-channel-following-limits-33997332dd34/>user can follow up to 2000 channels on the Twitch service</a>.<p>In KlipTok, we store that collection of channels so that each user has 1 document with the channels they follow stored in an array like so:<pre><code class=language-json>{
   "ChannelIds": [
      "Channels/102402222",
      "Channels/32402099",
      "Channels/63208102",
      "Channels/52093029"
   ]
}</code></pre><p>This lets me run the following query in C# against our <a href=https://ravendb.net>RavenDb database</a> to return the collection of Channels that a user follows:<pre><code class=language-csharp>using var session = Store.OpenAsyncSession();
var followRecord = await session.LoadAsync&lt;FollowerRecord>(
    "Followers/96909659",
    i => i.IncludeDocuments(f => f.ChannelIds)
);

var followedChannels = await session.LoadAsync&lt;ChannelProfile>(followRecord.ChannelIds);</code></pre><p>The first query loads identifies the record in the <code>FollowRecords</code> collection immediately as it is loading that record using a document id. In a relational database, you would call the document id a primary key. The include of the ChannelIds using the <code>IncludeDocuments</code> method will fetch all of the <code>ChannelProfile</code> records into .NET memory that are referenced in the <code>ChannelIds</code> property. In the case of our sample data above, we load 4 <code>ChannelProfile</code> records at the same time as the <code>FollowRecord</code> object from RavenDb into .NET memory.<p>The final query that populates the <code>followedChannels</code> variable from those <code>ChannelProfile</code> objects already stored in memory.<p>To add the <em>PinnedChannels</em> feature, we simply added another collection of ChannelIds to the <code>FollowRecord</code> object. This means that sample data from above now looks like the following:<pre><code class=language-json>{
   "ChannelIds": [
      "Channels/102402222",
      "Channels/32402099",
      "Channels/63208102",
      "Channels/52093029"
   ],
   "PinnedChannelIds": [
      "Channels/221740520"
   ]
}</code></pre><p>We can now use a similar query to fetch the profiles of those pinned channels.<pre><code class=language-csharp>using var session = Store.OpenAsyncSession();
var followRecord = await session.LoadAsync&lt;FollowerRecord>(
    "Followers/96909659",
    i => i.IncludeDocuments(f => f.PinnedChannelIds)
);

var pinnedChannels = await session.LoadAsync&lt;ChannelProfile>(followRecord.PinnedChannelIds);</code></pre><p>Easy... and we can update the <code>PinnedChannelIds</code> collection with a simple <em>Patch</em> command:<pre><code class=language-csharp>followRecord.PinnedChannelIds = new string[] { "Channels/148746662", "Channels/221740520" };
session.Advanced.Patch&lt;FollowerRecord, IEnumerable&lt;string>>(
    "Followers/96909659",
    f => f.PinnedChannelIds,
    newPinned);
await session.SaveChangesAsync();</code></pre><p>In a relational database, this <em>patch</em> command would feel like an update statement that updates a record based on its primary key.<h2 id=whats-next-for-pinned-channels>What's next for pinned channels?</h2><p>The last part of the pinned channels feature request was to populate the first clips that you find on the KlipTok home page with the <em>latest clips</em> that you have not seen from the channels that you have pinned. This is a tricky change that involves tracking which clips you watch and using that to determine which clips to add to the home page.<p>I'm working through the schema adjustments for this, as well as the privacy implications of tracking this information. I'll have more to share as that feature completes over the next week.<h2 id=looking-forward.to-the-kliptok-mobile-app>Looking forward.. to the KlipTok mobile app</h2><p>I'm getting very comfortable working with <a href=https://docs.microsoft.com/dotnet/maui/what-is-maui>.NET MAUI</a> and have made some initial steps into building a mobile app to complement KlipTok. I hope to move into working full-time on the mobile app in July.<p>The playlists feature has received some cool updates and we're lookng at completing a rollout of a borderless playlist player that you can use with OBS or other tools to create a 'be right back' or 'intro' screen that shows some highlights for you. We're <a href=https://feedback.kliptok.com/posts/107/streamelements-widget-that-embeds-playlists>planning an integration</a> with <a href=https://streamelements.com>Stream Elements</a> so that you can add a playlist widget to your StreamElements layouts.<p>We're also planning updates to the notifications system as well as some user-interface updates around the login process. Look for these in the August / September timeframe.<p>How do you use KlipTok? What can we do to make it more interactive for you and other viewers? Vote on the <a href=https://feedback.kliptok.com>feedback site</a>, add your comments to existing items, or tweet us at <a href=https://twitter.com/thekliptok>twitter.com/thekliptok</a><h2 class=postTitle><a href=posts/6-IntroducingChannelSuggestions.html>Introducing Channel Suggestions</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 5/10/2022 21:11:00</h5><p>Our team that's been working on KlipTok has no experience with building machine learning algorithms. With some advice from friends on the <a href=https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet>ML.NET</a> project team, they got us pointed to a few demos that would allow us to start using the power of machine learning to make more interesting interactions with KlipTok.<p><img src=img/601-MachineLearningGeneratedSuggestedStreamers.png alt="The new suggested streamers panel on KlipTok, generated using ML.NET"><p>ML.NET makes it easy for .NET developers to build, manage, and consume machine-learning models. We believe can unlock some interesting insights from the KlipTok data using this framework.<p>In particular, we went through the <a href=https://docs.microsoft.com/dotnet/machine-learning/tutorials/movie-recommendation>"Movie Recommendation" tutorial</a> and immediately identified some changes that we could implement in KlipTok. In particular, let's use a similar technique to suggest channels based on the channels you already follow on Twitch.<p>Let me explain how we use ML.NET to recommend channels for KlipTok.<h2 id=building-a-model-to-recommend-channels>Building a model to recommend channels</h2><p>The demo in the "Movie Recommendation" tutorial analyzes ratings of movies and makes recommendations to you based on similar ratings of the same movie. We can take this concept and simplify it to the shopping cart scenario:<blockquote><p>Hey, you just put <strong>Product X</strong> in your cart and lots of folks that buy <strong>Product X</strong> also buy <strong>Product Y</strong>. Would you like to also add <strong>Product Y</strong> to your cart?</blockquote><p>Fortunately, the tutorial has a link to some sample code that covers exactly this scenario, referred to as <a href=https://github.com/dotnet/machinelearning-samples/tree/main/samples/csharp/getting-started/MatrixFactorization_ProductRecommendation>"One Class Matrix Factorization"</a>.<p>The data for this becomes very simple: we just need two fields in our records. One field contains the id of the user who is following the id of the channel in the second field. I built a small class called <code>FollowerDataForAnalysis</code><pre><code class=language-csharp>
	public class FollowerSummaryForAnalysis
	{

		public string UserId { get; set; }

		public string ChannelId { get; set; }

	}
</code></pre><p>I might have been able to create this as a C# <code>record</code> object, but I'm going to run with this class for now.<p>The ML.NET object that we use to build models and work with them is called the MLContext. In my case, I created an <code>MLContext</code> and load these <code>FollowerSummaryForAnalysis</code> data points from my database. I then configure the datapoints in the MLContext for analysis:<pre><code class=language-csharp>
  IEnumerable&lt;FollowerSummaryForAnalysis> followersAnalysis = LoadFromDatabase();

  var trainingDataView = _Context.Data.LoadFromEnumerable(followersAnalysis);

  var estimator = _Context.Transforms.Conversion.MapValueToKey(outputColumnName: "userIdEncoded", inputColumnName: nameof(FollowerSummaryForAnalysis.UserId))
    .Append(_Context.Transforms.Conversion.MapValueToKey(outputColumnName: "channelIdEncoded", inputColumnName: nameof(FollowerSummaryForAnalysis.ChannelId)));
</code></pre><p>Next, I need to define some options for the model that will analyze the data. I'm not too sure what these data points mean, but they were recommended by the tutorial. I do know that I want it to repeat the training 3000 times in order to improve the data model.<pre><code class=language-csharp>
  var options = new MatrixFactorizationTrainer.Options
  {
      MatrixColumnIndexColumnName = "userIdEncoded",
      MatrixRowIndexColumnName = "channelIdEncoded",
      LabelColumnName = "Followed",
      LossFunction = MatrixFactorizationTrainer.LossFunctionType.SquareLossOneClass,
      Alpha = 0.01,
      Lambda = 0.025,
      NumberOfIterations = 3000,
      C = 0.00001,
      Quiet = true
  };

  var trainerEstimator = estimator.Append(_Context.Recommendation().Trainers.MatrixFactorization(options));
</code></pre><p>At this point, we can train the model with the <code>Fit</code> method on the <code>trainerEstimator</code> object:<pre><code class=language-csharp>
_Model = trainerEstimator.Fit(trainingDataView);
</code></pre><p>Finally, I save the model into a <code>Stream</code> object that persists my model into Azure Blob storage so that it can be used in Azure Functions for the KlipTok API.<pre><code class=language-csharp>
_Context.Model.Save(_Model, trainingDataView.Schema, destinationStream);
</code></pre><p>I currently have this model generation and save operation running once a day.<h2 id=loading-the-model-and-serving-up-predictions>Loading the model and serving up predictions</h2><p>The model can be loaded into a <code>PredictionEngine</code> to predict a potential channel suggestion for a user. In order to deliver that, we need to run predictions for a collection of candidate channels. KlipTok will look at the 200 channels that most recently created clips and run those through the <code>PredictionEngine</code> for the logged in user and present a subset of 4 channels to suggest on the sidebar of KlipTok's user interface.<p>To enable the prediction engine to run faster, I have configured a <code>PredictionEnginePool</code> that will reuse resources and allow predictions to run significantly faster. In testing on my local machine, it can run 200 predictions in less than 20ms.<p>I added the following line to <code>Startup.cs</code> in my Azure Functions project to enable the pooling mechanism:<pre><code class=language-csharp>  services.AddPredictionEnginePool&lt;FollowerSummaryForAnalysis,ChannelPrediction>()
    .FromUri(
      uri: "https://myblobstorage.blob.core.windows.net/channelDiscoveryModel.zip",
      period: TimeSpan.FromMinutes(30)
    );</code></pre><p>This tells the prediction engine to attempt to reload the model from disk every 30 minutes.<p>With the engine loaded, I can run predictions with this code:<pre><code class=language-csharp>public IEnumerable<suggestedstreamer> SuggestChannels(string userId, IEnumerable<channelprofile> candidateChannels, int maxCount)
{

  var outList = new List<suggestedstreamer>();

  foreach (var channel in candidateChannels)
  {

    var input = new FollowerSummaryForAnalysis()
    {
      UserId = userId,
      ChannelId = channel.ChannelId
    };

    var score = _PredictionEngine?.Predict(input) ?? _PredictionEnginePool.Predict(input);
    outList.Add(new SuggestedStreamer
    {
      DisplayName = channel.DisplayName,
      ProfilePicUrl = channel.ProfilePicUrl,
      TwitchUserId = channel.ChannelId,
      Score = (decimal)Math.Round(score.Score, 5)
    });
  }
}</suggestedstreamer></channelprofile></suggestedstreamer></code></pre><p>After this is fetched, we only transmit 20 channels to the browser. The user interface will remove any channels that are muted and take a random subset of 4 channels to present in the sidebar.<h2 id=summary>Summary</h2><p>I was really happy with how easy it was to adapt a tutorial for ML.NET and get some relevant recommandations for the KlipTok application. In the future, we'd like to use this technique to also recommend clips to visitors.<h2 class=postTitle><a href=posts/4-Introducing_Playlists.html>Updates, 11 Million Clips, and Introducing Playlists</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 5/1/2022 16:00:00</h5><p>It's been a long while since we've published an update about KlipTok, and there's a lot to document that's happened since. More clips, more features, architecture changes and cool new features we're planning.<p>Let's first talk about growth. KlipTok indexes a LOT of clips<h2 id=million-clips>11 Million clips!</h2><p><img src=img/11million.png alt="Line graph showing 11 million clips indexed"><p>We've crossed more than 11 million clips that have been indexed on the site. This is a jump of 9 million clips since May 2021, an 550% increase in data over that time. We're thrilled to see the growth in content, and want to encourage more folks to try KlipTok. There's a great catalog of channels, clips, and transcriptions for you to explore.<p>For those that are interested, this accounts for about 50GB of database storage.<h2 id=latest-feature-playlists>Latest Feature - Playlists</h2><p>Among the cool and unique features on KlipTok, you can now login with your Twitch account and create Playlists of clips from any channel. By grouping together these clips, you can share your playlists for others to view or to collect special memories almost like a "photo album".<p>Each user has their own collection of playlists, available from their streamer page or from the menu hiding under your profile picture.<p><img src=img/1-playlists.png alt="Fritz's Playlists"><p>Unlike other Twitch clips, these clips pay back to back to back with no advertising or pausing between videos. It's a non-stop video of Twitch shenanigans!<p><img src=img/2-playlist.png alt="Fritz's Fun Clips playlist, featuring a NASA clip"><p>You can get started creating and adding clips to a playlist just by logging in and clicking the + at the bottom-right of any clip you'd like to add to a playlist.<p><img src=img/3-AddToPlaylist.png alt="Fritz loses in Connect 4 and the new 'Add Playlist' button on the bottom right with a context menu to select a playlist to add to"><p>If you want to change the order of clips on your playlists, or remove clips from the playlist, you can click the edit button on the Playlists page or the playlist itself.<p><img src=img/4-EditPlaylist.png alt="Edit Playlists page"><p>You can then share your playlists with the 'Share button' at the top of the playlist page, right next to the 'Edit' button.<p>Have fun with playlists, they're a great way to group together some of your favorite videos and share with your friends.<h2 id=search-improvements>Search Improvements</h2><p>KlipTok's search feature keeps getting better. With this update, you can now filter search results by channels you follow or don't follow or even a specified list of channels you want to search, as well as filtering based on a Twitch category.<p><img src=img/5-SearchImprovements.png alt="New KlipTok Search Results page"><p>KlipTok's <em><strong>EXCLUSIVE</strong></em> search across transcriptions of clips continues to grow. We're adding new channels to the transcription feature and hope to see this continue to improve with our partner <a href=https://assemblyai.com>AssemblyAI</a><h2 id=streamer-dashboard-improvements>Streamer Dashboard Improvements</h2><p>Have you wondered when the most clips are being generated for your channel? Who are the folks creating the most watched clips?<p>We've added some updates to the streamer dashboard on your streamer page, just click the 'Dashboard' link at the top (or button at the bottom of your mobile web browser) and you can see the clips created over the last 90 days, a heat map of when the clips were created, and more details about who is creating clips.<p>All of these entries in the bar charts, heat map, and lists or clippers and categories are all clickable so that you can search for JUST those clips.<p><img src=img/6-Dashboard.png alt="Improved Streamer Dashboard"><h2 id=live-channels-and-sidebar-refresh>Live Channels and Sidebar Refresh</h2><p>We've added 'now live' indicators to the KlipTok sidebar as well as a block of up to 4 channels that recently went live, regardless of whether those 4 channels have clips. In this way, you can see which of the channels you enjoy are live and how long they've been live.<p>We're continuing to show the links to the channels you follow that had the most recent clips created, in the lower third of the sidebar.<p><img src=img/7-sidebar.png alt="Snippet of Fritz's sidebar showing some streamers that are currently live."><p>If other streamers in the Suggested and Followed channels sections are live as well, they will also display a similar 'live indicator'. All of the live indicators can be clicked to jump right to that channel on Twitch.<p>The sidebar now updates every 2 minutes, refreshing the list of Suggested Streamers and updating the 'Recently Live Streamers' section with up to date information about who recently went live.<p>We've also added some menus on the sidebar as kabob menus that allow you to jump to that channel's dashboard, the clips that streamer has created, or to mute the channel.<p><img src=img/8-sidebar-contextmenu.png alt="The new sidebar context menu"><h2 id=database-updates>Database Updates</h2><p>In August 2021, we started a long process to update the KlipTok database to <a href=https://ravendb.net>RavenDb</a>. RavenDb gives KlipTok a NoSQL style storage engine, complete with full-text search and adaptive indexes. RavenDb is such a smart database that when it sees things are running slow it builds a new index to make things FASTER.<p><img src=img/10-RavenDbCluster.png alt="RavenDb Cluster Topology in May 2022"><p>We're currently running KlipTok on RavenDb Cloud in an Azure datacenter on 3 nodes for redundancy.<p>We'll publish more details about the migration to RavenDb in the weeks ahead.<h2 id=twitch-integrated-panel>Twitch Integrated Panel</h2><p>You can now add KlipTok to your Twitch channel! We built and deployed an extension to Twitch that shows the clips created by day of week and the folks from your Twitch community that have created the most viewed clips on your channel.<p><img src=img/9-KlipTokDock.png alt="KlipTok Dock extension on Twitch"><p>Look for the <a href=https://dashboard.twitch.tv/extensions/eakutjhdwh3m1p7vd7uodnvweuhzmz-0.2.0>KlipTokDock extension on Twitch</a> to add this panel to your channel.<h2 id=summary>Summary</h2><p>We've added a LOT of features to KlipTok over the last few months and have not spent as much time promoting and sharing those features on this blog. We're going to get back to that and share more in the months ahead.<p>We're about to start work on a discovery algorithm to help recommend new clips and streamers on Twitch that we think you'll enjoy. This algorithm will be built with ML.NET, Azure Functions, and RavenDb.<p>Take a look at <a href=https://kliptok.com>KlipTok</a> and explore some of the great Twitch clips that we have indexed for you.<h2 class=postTitle><a href=posts/4-FourMillionChannels.html>Milestone Reached - 4 MILLION Clips Indexed!</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 8/19/2021 21:00:00</h5><p>KlipTok just crossed another major milestone on the evening of August 18th:<div class=center><p><img src=img/4million.PNG alt="4 million clips on the KlipTok dashboard"></div><p>We're now service more than 4 million klips for about 750 Twitch channels with more than 11k transcriptions. It's a huge step, and is stored on about 10GB of storage for the database and search indexes.<h2 id=how-are-those-4-million-clips-stored-and-indexed>How are those 4 million clips stored and indexed?</h2><p>The clips are stored in a MySql database hosted on Microsoft Azure that allows us to join in and query based on the channel id or the unique 'slug' text that identifies the clip.<p>There are entries in <a href=https://azure.microsoft.com/services/storage/tables/>Azure Table Storage</a> for the titles of the clips and the transcriptions of the clips. This table storage is further indexed by <a href=https://azure.microsoft.com/services/search/>Azure Cognitive Search</a> so that you can search for clips based on the title of the clip or the words spoken in the clip.<p>I use <a href=https://azure.microsoft.com/services/service-bus/>Azure Service Bus</a> to process all of these records as they arrive from Twitch, get processed by AssemblyAI for transcripts, and store the clip data for processing and search indexing.<p>That's... that's a lot of storage to manage and indexes to update. What if we could make that a lot more concise and simpler?<h2 id=enter-ravendb>Enter RavenDb</h2><p>Starting next week, we're going to start migrating data to RavenDb. <a href=https://ravendb.net>RavenDb</a> is a NoSQL database provider that has a bunch of smart features built into it that allow it to detect and build indexes appropriately for our queries. It also has a built in search indexing feature that allows us to generate a search index and search fields in document records.<p>Additionally, I have found and witnessed a few demos that show how to build an elementary recommendation engine using RavenDb queries. When I saw these demos, I was sold on being able to build and roll out a better list of recommended channels and clips to discover on the front page of KlipTok.<p>RavenDb feels like a perfect match for the various ways that we store and interact with clip data for KlipTok. I hope you tune in to the <a href=https://twitch.tv/csharpfritz>csharpfritz Twitch stream</a> in the week ahead as I migrate and roll out this update.<h2 class=postTitle><a href=posts/3-IntroducingCategoriesAndContentSafety.html>Version 0.23 - Introducing IAB Categories and Content Safety</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 8/14/2021 14:15:00</h5><p>This week we are happy to announce the release of Version 0.23 with a number of small fixes, updated translations, a new translation for Slovenian, and a new feature: IAB Categories and Content Safety tags for transcribed clips. I'm definitely burying the lede here, but I think it's worth it to give you a quick summary of what's new.<h2 id=iab-categories-and-content-safety>IAB Categories and Content Safety</h2><p>With our partners at <a href=https://assemblyai.com>Assembly AI</a>, we've introduced IAB Categories and Content Safety tags to clips. You'll recall that we added clip transcriptions to KlipTok in July and made those transcriptions available to search. We're the only website on the internet where you can search for videos based on the dialogue in the video.<div class=center><p><img src=img/transcription_search.png alt="Search for 'Thanks Amanda' and finding the clip"><p><span aria-label=caption class=caption>Search for 'Thanks Amanda' and finding the clip where I say "Thanks Amanda"</span></div><p>The <a href=https://www.iab.com>Interactive Advertising Bureau (IAB)</a> has a set of categories that you can use to categorize your videos. They're a great way to make sure that your videos are appropriate for children and young people. A <a href=https://www.iab.com/guidelines/video-ad-categories/>full list of categories</a> is available online. We've added the categories to KlipTok and you can see them tagged on clips that have been transcribed.<div class=center><p><img src=img/IabAndSafetyTags.PNG alt="IAB Category Tags and Content Safety Tags for a clip"><p><span aria-label=caption class=caption>IAB Category Tags and Content Safety Tags for a clip</span></div><p>AssemblyAI provides a feature to <a href=https://docs.assemblyai.com/guides/iab-categorization>detect the IAB Categories</a> of your videos based on their transcript. These categories can be VERY accurate... and sometimes a little funny in what they are guessing your clips are about. KlipTok is only going to show the first 4 categories with more than 60% confidence that it thinks your video falls into. There's a hidden tooltip on each of the tags showing the confidence percentage reported by AssemblyAI's detection algorithm for that category on the clip.<h3 id=content-safety-tags>Content Safety tags</h3><p>The second AssemblyAI detection feature we are implementing is the <a href=https://docs.assemblyai.com/guides/content-safety-detection>detection of content safety</a> warnings. This feature uses the same transcription analysis and detection request to detect foul language and other topics that may require content safety warnings in various cultures. These tags are added with a red background to separate them from the category tags. Just like the IAB category tags, you can inspect the hidden tooltip on each tag to see the confidence percentage reported by AssemblyAI for each tag.<h2 id=translation-updates>Translation Updates</h2><p>Translations for KlipTok (to date) have been created and maintained by the user community. We saw a few updates over the last week for Farsi, Finnish, German, Indonesian, Italian, and Polish translations. Additionally, Slovenian was added to our roster of 23 languages supported by KlipTok.<p>Finally, we have updated the translation combobox to list each supported language in their native language to make it easier to locate and translate KlipTok to your preferred written language.<div class=center><p><img src=img/translation_box.PNG alt="Native translations of the languages in the language selector"><p><span aria-label=caption class=caption>Native translations of the languages in the language selector</span></div><h3 id=how-does-kliptok-translate-to-your-language>How does KlipTok translate to your language?</h3><p>KlipTok uses a library called <a href=https://github.com/jsakamoto/Toolbelt.Blazor.I18nText>Toolbelt.Blazor.I18nText</a> to translate its text. There is an object embedded in every Blazor component delivered on KlipTok called <code>Localize</code> that loads up the correct translation file for your language.<pre><code class=language-csharp>	if (Localize == null)
	{
		Localize = await I18nText.GetTextTableAsync<i18ntext.kliptok>(this);
		StateHasChanged();
	}</i18ntext.kliptok></code></pre><p>All text that is rendered for the web page passes through that collection. The Search bar at the top of the screen has it's watermark text placed with:<pre><code class=language-csharp>@Localize?["SearchKlipTok"]</code></pre><p>The search results text referencing the <code>SearchTerm</code> submitted is formatted like this:<pre><code class=language-csharp><p>@string.Format(Localize?["SearchedKlipTokAndFoundTemplate"], SearchTerm)</code></pre><p>The translations are all stored in JSON format and open for community contributions <a href=https://github.com/csharpfritz/KlipTok.Translations>on GitHub</a><h2 id=up-next>Up Next</h2><p>KlipTok has grown and become a bit more complex over the last few months. We're service more than 3.8 million clips and need to provide some assurance that updates to the site don't break things. I've started working on building integration tests using <a href=https://playwright.dev>Playwright</a> and will be making those test scripts publicly available <a href=https://github.com/csharpfritz/KlipTok.IntegrationTests>on GitHub</a> as well.<h2 id=summary>Summary</h2><p>Introducing these new features and translations has added a lot of value to KlipTok and made it easier for your to understand the content you'll find in the clips we present. I hope you find these new features useful as I move forward with additional improvements.<h2 class=postTitle><a href=posts/2-IntroducingLiveIndicators.html>Most Requested Feature Deployed - Live Now on Twitch</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 7/31/2021 16:00:00</h5><p>Over the last few months, the most requested feature on KlipTok on the <a href=https://feedback.kliptok.com>feedback site</a> has been the addition of a "Live Now" indicator for the list of channels.<div class=center><p><a href=https://feedback.kliptok.com/posts/23/live-now-icon-next-to-the-channels-name-in-the-list-of-streamers><img src=img/feedback-LiveIndicator.png alt="Screenshot from feedback.kliptok.com - Request to add a 'Live' indicator next to channels"></a><p><span aria-label=caption class=caption>Original feedback requesting the Live Indicator</span></div><p>On Twitch, its a simple red circle.. the circle doesn't really tell you anything, and you need to hover over it in order to see what it actually means. On KlipTok, we want to be more inclusive and support folks that have different web usage capabilities.<p>Our 'Live Now' indicator is a red rounded square with the word 'LIVE' in the middle. It's easy to spot and clear what it's referring to. If you click on it, you'll be taken to their channel in a new tab of your browser.<p>You can even use the sidebar refresh buttons, the spinning arrows next to the titles in the sidebar, to refresh the list of current channels that KlipTok has for you and it will update the Live status appropriately as well.<div class=center><p><img src=img/liveIndicator.png alt="Screenshot of KlipTok showing the new LIVE indicator in the sidebar"><p><span aria-label=caption class=caption>Implementation of the Live Indicator on KlipTok</span></div><h2 id=behind-the-feature-how-does-it-work>Behind the feature - How does it work?</h2><p>As more of KlipTok is built, we're going to use this as an opportunity to <strong>TEACH</strong> more about how to build websites and the features behind them. Going forward, look for descriptions about the KlipTok architecture, but not all of our secrets, whenever a new feature is released.<h3 id=getting-the-live-status-from-twitch>Getting the Live Status from Twitch</h3><p>The <a href=https://dev.twitch.tv/docs/api/reference#get-streams>Twitch APIs</a> make it easy to run a query to collect the current state of a stream.<pre><code>GET https://api.twitch.tv/helix/streams?user_id=96909659&amp;user_id=63208102
</code></pre><p>This query would return data similar to the following:<pre><code>{
  "data": [
    {
      "id": "41375541868",
      "user_id": "96909659",
      "user_login": "csharpfritz",
      "user_name": "csharpfritz",
      "game_id": "509670",
      "game_name": "Science &amp; Technology",
      "type": "live",
      "title": "Writing software",
      "viewer_count": 78,
      "started_at": "2021-03-10T15:04:21Z",
      "language": "es",
      "thumbnail_url": "https://static-cdn.jtvnw.net/previews-ttv/live_user_auronplay-{width}x{height}.jpg",
      "tag_ids": [
        ""
      ],
      "is_mature": false
    },
    ...
  ],
  "pagination": {
    "cursor": "abcdef1234"
  }
}
</code></pre><p>When KlipTok's background processes run to discover newly created clips, they inspect the list of currently active streams and ONLY search those streams for new clips. We know that more than 95% of the clips that are created for a stream are created while the broadcaster is actively streaming, so we focus on collecting those clips as they are created. Once an hour, we examine ALL channels that KlipTok has indexed.<p>Since we were collecting this data about the active streams in order to filter the list of channels that the KlipTok processes were searching against, why not save that information and present it to the KlipTok users as they use the site? Easy enough... we created a <code>LiveChannels</code> table and stored the id of the channels that are currently streaming.<p>I wrote a method on our <code>LiveChannelsRepository</code> class that would <code>Replace</code> the current contents of the table with the collection of the live channels we discovered. It's crude, but it works.<pre><code class=language-csharp>	await _LiveChannelsRepository.Replace(
		liveChannels.Select(l => new Twitch.TwitchStreamRecord
		{
			user_id = l.ChannelId,
			started_at = l.LiveSince
		})
	);</code></pre><p>When we assemble the sidebar for a user, we include the <code>LiveChannels</code> table in the query and present the Live Indicator when a record is present in the <code>LiveChannels</code> table for the channel in the sidebar.<h2 id=summary>Summary</h2><p>Adding this feature was a great re-use of existing data that KlipTok was already working with, and feels almost like re-using content with no additional cost to us. Stay tuned as we add new Search features, clip metadata, and launch the Top 5 Klips of the Week in August.<h2 class=postTitle><a href=posts/1-WelcomeToKlipTok.html>Welcome to KlipTok!</a></h2><h4>Written By: Jeff Fritz</h4><h5>Published: 7/24/2021 14:22:00</h5><p>This is our first post on the KlipTok blog, and I'm thrilled to have this live for folks to learn more about how KlipTok is built and to allow us to announce new features as well as milestones reached. I'll have a few more posts today and later this week talking about what KlipTok is, how it was built, and how you can participate.<h2 id=how-it-started>How it started</h2><p>KlipTok has been built by a Twitch Streamer, for Twitch Streamers, LIVE on Twitch. It started in November 2020 as an idea to help make Twitch clips more discoverable with a UI that brought your favorite clips from the channels you follow. That 12-hour stream is archived and available:<div style=width:100%;text-align:center><iframe width=560 height=315 src="https://www.youtube.com/embed/6uMCAHEM8Es?start=310" title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><p>The technical goal of this web application was to build a complete site using the <a href=https://blazor.net>Blazor web framework</a> with <a href=https://dot.net>C# and .NET 5</a> running completely on <a href=https://azure.microsoft.com>Microsoft Azure</a>. We use Azure Static Websites to make that happen along with a number of other Microsoft Azure services, and we'll cover more of that in an upcoming blog post.<h2 id=fast-forward-to-today>Fast Forward to Today</h2><p>At the time of the writing of this blog post (at the end of July 2021), we're about 8 months into the evolution of the site and it hosts about 680 channels clips. There are more than 3.1 million clips that KlipTok has indexed and are available for you to discover.<p>We've added the ability for the site to be translated to a number of different languages with the help of our KlipTok community. The translations are all available in JSON format <a href=https://github.com/csharpfritz/KlipTok.Translations>on GitHub</a> and you are welcome to contribute new or missing translations.<p>Viewer and user feedback is VERY important to me in the construction of KlipTok, and I've configured a user feedback website using <a href=https://getfider.com>Fider</a>. You can see the requested features and my notes about the next features that are going to be built at <a href=https://feedback.kliptok.com>https://feedback.kliptok.com</a><p>I'm writing a handful of posts to get things started here to describe some of the direction behind the site, the tenets we follow as development progresses, and the Azure-based architecture used.<p>I hope to separate the Blazor application into its own repository and release the UI as an open source project before the end of July 2021. In this way, you can learn from how the application was written and even contribute back some updates to improve the user-interface.<h2 id=one-more-thing>One more thing...</h2><p>I've added an amazing feature to KlipTok with the help of the folks at <a href=https://assemblyai.com>Assembly AI</a> to provide transcription for clips. This means you can search for clips based on what was SAID in the clip, not just the title of the clip. This is the ONLY video sharing service on the internet that provides this service, and we have much more planned with our friends at Assembly AI.<h2 id=summary>Summary</h2><p>So.. welcome to KlipTok! I'm looking forward to building much more for this web application and learning about how to use many more cloud services and taking advantage of the coolest new .NET technologies to grow it and make it an application you find useful.</div></div></main><footer>Copyright ¬©2021 - 2023 KlipTok Inc.</footer><script src=prism.js></script></body></html>