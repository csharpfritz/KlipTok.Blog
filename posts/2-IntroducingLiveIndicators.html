<html>
	<head>
		<title>Most Requested Feature Deployed - Live Now on Twitch</title>
		<base href="./../">
		<link rel="stylesheet" type="text/css" href="site.css">
		<link rel="stylesheet" type="text/css" href="prism.css">


		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-371VNCMVCF"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-371VNCMVCF');
		</script>		
	</head>
	<body>

		<header>
			<div class="container">
				<a href="../"><img src="kliptok.png" alt="KlipTok Logo" /></a>
				<div>
					<h1>KlipTok News and Notes</h1>
					<h3>All the latest updates about the KlipTok application</h3>
				</div>
			</div>
		</header>

		<main>

			<div id="sidebar">
				
				<h2>Links</h2>
				<ul>	
					<li><a href="https://kliptok.com">KlipTok</a></li>
					<li><a href="https://feedback.kliptok.com">KlipTok Feedback</a></li>
					<li><a href="https://github.com/csharpfritz/KlipTok.Translations">Translation Repository</a></li>
				</ul>

				<h2>KlipTok uses:</h2>
				<ul>
					<li><a href="https://www.telerik.com/blazor-ui">Telerik UI for Blazor</a></li>
					<li><a href="https://assemblyai.com">Assembly AI transcription services</a></li>
				</ul>

				<a href="https://twitter.com/thekliptok?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @thekliptok</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

			</div>

			<div id="main">

				<div id="content">

					<h1>Most Requested Feature Deployed - Live Now on Twitch</h1>
					<h5>Published: 7/31/2021 16:00:00</h5>
			
					<p>Over the last few months, the most requested feature on KlipTok on the <a href="https://feedback.kliptok.com">feedback site</a> has been the addition of a &quot;Live Now&quot; indicator for the list of channels.</p>
<div class="center">
<p><a href="https://feedback.kliptok.com/posts/23/live-now-icon-next-to-the-channels-name-in-the-list-of-streamers"><img src="img/feedback-LiveIndicator.png" alt="Screenshot from feedback.kliptok.com - Request to add a 'Live' indicator next to channels" /></a></p>
<p><span aria-label="caption" class="caption">Original feedback requesting the Live Indicator</span></p>
</div>
<p>On Twitch, its a simple red circle.. the circle doesn't really tell you anything, and you need to hover over it in order to see what it actually means.  On KlipTok, we want to be more inclusive and support folks that have different web usage capabilities.</p>
<p>Our 'Live Now' indicator is a red rounded square with the word 'LIVE' in the middle.  It's easy to spot and clear what it's referring to.  If you click on it, you'll be taken to their channel in a new tab of your browser.</p>
<p>You can even use the sidebar refresh buttons, the spinning arrows next to the titles in the sidebar, to refresh the list of current channels that KlipTok has for you and it will update the Live status appropriately as well.</p>
<div class="center">
<p><img src="img/liveIndicator.png" alt="Screenshot of KlipTok showing the new LIVE indicator in the sidebar" /></p>
<p><span aria-label="caption" class="caption">Implementation of the Live Indicator on KlipTok</span></p>
</div>
<h2 id="behind-the-feature-how-does-it-work">Behind the feature - How does it work?</h2>
<p>As more of KlipTok is built, we're going to use this as an opportunity to <strong>TEACH</strong> more about how to build websites and the features behind them.  Going forward, look for descriptions about the KlipTok architecture, but not all of our secrets, whenever a new feature is released.</p>
<h3 id="getting-the-live-status-from-twitch">Getting the Live Status from Twitch</h3>
<p>The <a href="https://dev.twitch.tv/docs/api/reference#get-streams">Twitch APIs</a> make it easy to run a query to collect the current state of a stream.</p>
<pre><code>GET https://api.twitch.tv/helix/streams?user_id=96909659&amp;user_id=63208102
</code></pre>
<p>This query would return data similar to the following:</p>
<pre><code>{
  &quot;data&quot;: [
    {
      &quot;id&quot;: &quot;41375541868&quot;,
      &quot;user_id&quot;: &quot;96909659&quot;,
      &quot;user_login&quot;: &quot;csharpfritz&quot;,
      &quot;user_name&quot;: &quot;csharpfritz&quot;,
      &quot;game_id&quot;: &quot;509670&quot;,
      &quot;game_name&quot;: &quot;Science &amp; Technology&quot;,
      &quot;type&quot;: &quot;live&quot;,
      &quot;title&quot;: &quot;Writing software&quot;,
      &quot;viewer_count&quot;: 78,
      &quot;started_at&quot;: &quot;2021-03-10T15:04:21Z&quot;,
      &quot;language&quot;: &quot;es&quot;,
      &quot;thumbnail_url&quot;: &quot;https://static-cdn.jtvnw.net/previews-ttv/live_user_auronplay-{width}x{height}.jpg&quot;,
      &quot;tag_ids&quot;: [
        &quot;&quot;
      ],
      &quot;is_mature&quot;: false
    },
    ...
  ],
  &quot;pagination&quot;: {
    &quot;cursor&quot;: &quot;abcdef1234&quot;
  }
}
</code></pre>
<p>When KlipTok's background processes run to discover newly created clips, they inspect the list of currently active streams and ONLY search those streams for new clips.  We know that more than 95% of the clips that are created for a stream are created while the broadcaster is actively streaming, so we focus on collecting those clips as they are created.  Once an hour, we examine ALL channels that KlipTok has indexed.</p>
<p>Since we were collecting this data about the active streams in order to filter the list of channels that the KlipTok processes were searching against, why not save that information and present it to the KlipTok users as they use the site?  Easy enough... we created a <code>LiveChannels</code> table and stored the id of the channels that are currently streaming.</p>
<p>I wrote a method on our <code>LiveChannelsRepository</code> class that would <code>Replace</code> the current contents of the table with the collection of the live channels we discovered.  It's crude, but it works.</p>
<pre><code class="language-csharp">	await _LiveChannelsRepository.Replace(
		liveChannels.Select(l => new Twitch.TwitchStreamRecord
		{
			user_id = l.ChannelId,
			started_at = l.LiveSince
		})
	);</code></pre>
<p>When we assemble the sidebar for a user, we include the <code>LiveChannels</code> table in the query and present the Live Indicator when a record is present in the <code>LiveChannels</code> table for the channel in the sidebar.</p>
<h2 id="summary">Summary</h2>
<p>Adding this feature was a great re-use of existing data that KlipTok was already working with, and feels almost like re-using content with no additional cost to us.  Stay tuned as we add new Search features, clip metadata, and launch the Top 5 Klips of the Week in August.</p>


				</div>	

			</div>

		</main>

		<footer>Copyright &copy;2021 Jeffrey T. Fritz</footer>

		<script src="prism.js"></script>
	</body>
</html>